<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Map vietnam hover effect</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://vietmaps.vn/vietmap-gl-js/v1.0.0/vietmap-gl.js"></script>
    <link href="https://vietmaps.vn/vietmap-gl-js/v1.0.0/vietmap-gl.css" rel="stylesheet" />
    <script type="text/javascript"
            src="https://raw.githubusercontent.com/hiimdat95/vietnam-statistics/master/diaphantinh.geojson"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        .map-overlay {
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            background-color: #fff;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            position: absolute;
            width: 25%;
            top: 10px;
            left: 10px;
            padding: 10px;
            display: none;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="map-overlay" class="map-overlay"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        // TO MAKE THE MAP APPEAR YOU MUST
        // ADD YOUR ACCESS TOKEN FROM
        // https://account.mapbox.com
        mapboxgl.accessToken = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5UZG1aak00WkRrM05qWTBZemM1TW1abU9EZ3dNVEUzTVdZd05ERTVNV1JsWkRnNE56YzRaQT09In0.eyJhdWQiOiJodHRwOlwvXC9vcmcud3NvMi5hcGltZ3RcL2dhdGV3YXkiLCJzdWIiOiJhZG1pbkBjYXJib24uc3VwZXIiLCJhcHBsaWNhdGlvbiI6eyJvd25lciI6ImFkbWluIiwidGllclF1b3RhVHlwZSI6InJlcXVlc3RDb3VudCIsInRpZXIiOiJVbmxpbWl0ZWQiLCJuYW1lIjoiTWFwIFNlcnZpY2UiLCJpZCI6MywidXVpZCI6bnVsbH0sInNjb3BlIjoiYW1fYXBwbGljYXRpb25fc2NvcGUgZGVmYXVsdCIsImlzcyI6Imh0dHBzOlwvXC9hbS52aWV0bWFwcy52bjo0NDNcL29hdXRoMlwvdG9rZW4iLCJ0aWVySW5mbyI6eyJVbmxpbWl0ZWQiOnsidGllclF1b3RhVHlwZSI6InJlcXVlc3RDb3VudCIsInN0b3BPblF1b3RhUmVhY2giOnRydWUsInNwaWtlQXJyZXN0TGltaXQiOjAsInNwaWtlQXJyZXN0VW5pdCI6bnVsbH19LCJrZXl0eXBlIjoiUFJPRFVDVElPTiIsInN1YnNjcmliZWRBUElzIjpbeyJzdWJzY3JpYmVyVGVuYW50RG9tYWluIjoiY2FyYm9uLnN1cGVyIiwibmFtZSI6InJvdXRlIiwiY29udGV4dCI6Ilwvcm91dGVcL3YxIiwicHVibGlzaGVyIjoiYWRtaW4iLCJ2ZXJzaW9uIjoidjEiLCJzdWJzY3JpcHRpb25UaWVyIjoiVW5saW1pdGVkIn0seyJzdWJzY3JpYmVyVGVuYW50RG9tYWluIjoiY2FyYm9uLnN1cGVyIiwibmFtZSI6InNlYXJjaCIsImNvbnRleHQiOiJcL3NlYXJjaFwvdjEuMC4wIiwicHVibGlzaGVyIjoiYWRtaW4iLCJ2ZXJzaW9uIjoidjEuMC4wIiwic3Vic2NyaXB0aW9uVGllciI6IlVubGltaXRlZCJ9LHsic3Vic2NyaWJlclRlbmFudERvbWFpbiI6ImNhcmJvbi5zdXBlciIsIm5hbWUiOiJNYXJrZXIiLCJjb250ZXh0IjoiXC9tYXJrZXJcLzEuMCIsInB1Ymxpc2hlciI6ImFkbWluIiwidmVyc2lvbiI6IjEuMCIsInN1YnNjcmlwdGlvblRpZXIiOiJVbmxpbWl0ZWQifV0sImNvbnN1bWVyS2V5IjoiYVJWbm1UUUhRbWxydXRwQ1RLNVdmdVdXV0E0YSIsImV4cCI6MzczNjMyNTYxMSwiaWF0IjoxNTg4ODQxOTY0LCJqdGkiOiIyMDI2NWY5NC1mOWZlLTQ0NGItYWQ2Ni1hM2Q3NDk0YzkwZTkifQ.ZE63gv6YTsxqXN3OorriRnG49zGMIWoXF5phsf__IDz6yPPf0u9qCDng6hK7dE27sl7C3N2TtCrranc8iOC2p7t7pV-7tdRh0sgmI8qrl_2_xCAdikXzs2e69_WnI8C11ObDGz_i6T6ypiYWUSb9eqi833MabegPY6BlZp0FRBBsB1ssDClDllzXiYf7RbppdAl4bDa-So1Jq6cWAUk9GTeTw53LsF6FriijShLPm-RmN0fgzBoKsDTuTbYIHy_x4GRpTamheAyiFLBEJvyzh5CR_ARUip7nfQLVafFsQ83T8mmuHoEhBpMMzFCJKmJ4paqD1bA4hc9ThsPOxr9iNg';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'vietmap://styles/default/style.json',
            hash: true,
            center: [105.85473, 21.0334],
            zoom: 14,
            // maxBounds: [[102.0409, 7.730748], [111.6685, 23.47731]],
            attributionControl: false
        });
        var hoveredStateId = null;
        var overlay = document.getElementById('map-overlay');
        // Create a popup, but don't add it to the map yet.
        var popup = new mapboxgl.Popup({
            closeButton: false
        });

        map.on('load', function () {
            var geojson;
            $.ajax({
                type: "GET",
                url: "https://raw.githubusercontent.com/hiimdat95/vietnam-statistics/master/diaphantinh.geojson",
                dataType: "json",
                success: function (data) {
                    geojson = data;
                    geojson.features.forEach(function (geo) {
                        geo.id = geo.properties.gid;
                    });
                    map.addSource('states', {
                        'type': 'geojson',
                        'data': geojson
                    });

                    // The feature-state dependent fill-opacity expression will render the hover effect
                    // when a feature's hover state is set to true.
                    map.addLayer({
                        'id': 'state-fills',
                        'type': 'fill',
                        'source': 'states',
                        'layout': {},
                        'paint': {
                            'fill-color': '#627BC1',
                            'fill-opacity': [
                                'case',
                                ['boolean', ['feature-state', 'hover'], false],
                                1,
                                0.5
                            ]
                        }
                    });

                    map.addLayer({
                        'id': 'state-fills-warning',
                        'type': 'fill',
                        'source': 'states',
                        'layout': {},
                        'paint': {
                            'fill-color': '#fc4103',
                            'fill-opacity': [
                                'case',
                                ['boolean', ['feature-state', 'hover'], false],
                                1,
                                0.5
                            ]
                        }
                    });

                    map.addLayer({
                        'id': 'state-borders',
                        'type': 'line',
                        'source': 'states',
                        'layout': {},
                        'paint': {
                            'line-color': '#627BC1',
                            'line-width': 2
                        }
                    });

                    // When the user moves their mouse over the state-fill layer, we'll update the
                    // feature state for the feature under the mouse.
                    map.on('mousemove', 'state-fills', function (e) {
                        if (e.features.length > 0) {
                            if (hoveredStateId) {
                                map.setFeatureState(
                                    { source: 'states', id: hoveredStateId },
                                    { hover: false }
                                );
                            }
                            var feature = e.features[0];
                            hoveredStateId = feature.properties.gid;

                            map.setFeatureState(
                                { source: 'states', id: hoveredStateId },
                                { hover: true }
                            );
                            console.log('feature.properties.code', feature.properties.code)
                            if (feature.properties.gid == 24) {
                                feature.properties.ca_nhiem = 60;
                            } else {
                                feature.properties.ca_nhiem = 0;
                            }

                            var population = document.createElement('div');
                            population.textContent =
                                'Đây là: ' + e.features[0].properties.ten_tinh + ". Ca nhiễm:" + feature.properties.ca_nhiem;

                            var title = document.createElement('strong');
                            title.textContent = e.features[0].properties.ten_tinh;

                            // Render found features in an overlay.
                            overlay.innerHTML = '';
                            // Add features with the same county name
                            // to the highlighted layer.

                            // if (feature.properties.ca_nhiem > 0) {
                            //     // map.setFilter('state-warning', [
                            //     //     'in',
                            //     //     'gid',
                            //     //     feature.properties.gid
                            //     // ]);
                            // } else {
                            //     map.setFilter('state-borders', [
                            //         'in',
                            //         'gid',
                            //         feature.properties.gid
                            //     ]);
                            // }

                            overlay.appendChild(title);
                            overlay.appendChild(population);
                            overlay.style.display = 'block';

                            // Display a popup with the name of the county.
                            popup
                                .setLngLat(e.lngLat)
                                .setText(e.features[0].properties.ten_tinh)
                                .addTo(map);

                        }
                    });

                    // When the mouse leaves the state-fill layer, update the feature state of the
                    // previously hovered feature.
                    map.on('mouseleave', 'state-fills', function () {
                        if (hoveredStateId) {
                            map.setFeatureState(
                                { source: 'states', id: hoveredStateId },
                                { hover: false }
                            );
                        }
                        hoveredStateId = null;
                        popup.remove();
                        overlay.style.display = 'none';
                    });
                },

            });

        });
    </script>
</body>
</html>