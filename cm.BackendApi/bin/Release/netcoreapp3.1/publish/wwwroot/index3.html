<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Highlight features containing similar data</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://vietmaps.vn/vietmap-gl-js/v1.0.0/vietmap-gl.js"></script>
    <link href="https://vietmaps.vn/vietmap-gl-js/v1.0.0/vietmap-gl.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <style>
        .map-overlay {
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            background-color: #fff;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            position: absolute;
            width: 25%;
            top: 10px;
            left: 10px;
            padding: 10px;
            display: none;
        }
    </style>

    <div id="map"></div>
    <div id="map-overlay" class="map-overlay"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        // TO MAKE THE MAP APPEAR YOU MUST
        // ADD YOUR ACCESS TOKEN FROM
        // https://account.mapbox.com
        mapboxgl.accessToken = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5UZG1aak00WkRrM05qWTBZemM1TW1abU9EZ3dNVEUzTVdZd05ERTVNV1JsWkRnNE56YzRaQT09In0.eyJhdWQiOiJodHRwOlwvXC9vcmcud3NvMi5hcGltZ3RcL2dhdGV3YXkiLCJzdWIiOiJhZG1pbkBjYXJib24uc3VwZXIiLCJhcHBsaWNhdGlvbiI6eyJvd25lciI6ImFkbWluIiwidGllclF1b3RhVHlwZSI6InJlcXVlc3RDb3VudCIsInRpZXIiOiJVbmxpbWl0ZWQiLCJuYW1lIjoiTWFwIFNlcnZpY2UiLCJpZCI6MywidXVpZCI6bnVsbH0sInNjb3BlIjoiYW1fYXBwbGljYXRpb25fc2NvcGUgZGVmYXVsdCIsImlzcyI6Imh0dHBzOlwvXC9hbS52aWV0bWFwcy52bjo0NDNcL29hdXRoMlwvdG9rZW4iLCJ0aWVySW5mbyI6eyJVbmxpbWl0ZWQiOnsidGllclF1b3RhVHlwZSI6InJlcXVlc3RDb3VudCIsInN0b3BPblF1b3RhUmVhY2giOnRydWUsInNwaWtlQXJyZXN0TGltaXQiOjAsInNwaWtlQXJyZXN0VW5pdCI6bnVsbH19LCJrZXl0eXBlIjoiUFJPRFVDVElPTiIsInN1YnNjcmliZWRBUElzIjpbeyJzdWJzY3JpYmVyVGVuYW50RG9tYWluIjoiY2FyYm9uLnN1cGVyIiwibmFtZSI6InJvdXRlIiwiY29udGV4dCI6Ilwvcm91dGVcL3YxIiwicHVibGlzaGVyIjoiYWRtaW4iLCJ2ZXJzaW9uIjoidjEiLCJzdWJzY3JpcHRpb25UaWVyIjoiVW5saW1pdGVkIn0seyJzdWJzY3JpYmVyVGVuYW50RG9tYWluIjoiY2FyYm9uLnN1cGVyIiwibmFtZSI6InNlYXJjaCIsImNvbnRleHQiOiJcL3NlYXJjaFwvdjEuMC4wIiwicHVibGlzaGVyIjoiYWRtaW4iLCJ2ZXJzaW9uIjoidjEuMC4wIiwic3Vic2NyaXB0aW9uVGllciI6IlVubGltaXRlZCJ9LHsic3Vic2NyaWJlclRlbmFudERvbWFpbiI6ImNhcmJvbi5zdXBlciIsIm5hbWUiOiJNYXJrZXIiLCJjb250ZXh0IjoiXC9tYXJrZXJcLzEuMCIsInB1Ymxpc2hlciI6ImFkbWluIiwidmVyc2lvbiI6IjEuMCIsInN1YnNjcmlwdGlvblRpZXIiOiJVbmxpbWl0ZWQifV0sImNvbnN1bWVyS2V5IjoiYVJWbm1UUUhRbWxydXRwQ1RLNVdmdVdXV0E0YSIsImV4cCI6MzczNjMyNTYxMSwiaWF0IjoxNTg4ODQxOTY0LCJqdGkiOiIyMDI2NWY5NC1mOWZlLTQ0NGItYWQ2Ni1hM2Q3NDk0YzkwZTkifQ.ZE63gv6YTsxqXN3OorriRnG49zGMIWoXF5phsf__IDz6yPPf0u9qCDng6hK7dE27sl7C3N2TtCrranc8iOC2p7t7pV-7tdRh0sgmI8qrl_2_xCAdikXzs2e69_WnI8C11ObDGz_i6T6ypiYWUSb9eqi833MabegPY6BlZp0FRBBsB1ssDClDllzXiYf7RbppdAl4bDa-So1Jq6cWAUk9GTeTw53LsF6FriijShLPm-RmN0fgzBoKsDTuTbYIHy_x4GRpTamheAyiFLBEJvyzh5CR_ARUip7nfQLVafFsQ83T8mmuHoEhBpMMzFCJKmJ4paqD1bA4hc9ThsPOxr9iNg';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'vietmap://styles/default/style.json',
            hash: true,
            // center: area.center,
            center: [105.85473, 21.0334],
            zoom: 14,
            //maxBounds: area.maxBounds,
            attributionControl: false
        });
        var overlay = document.getElementById('map-overlay');

        // Create a popup, but don't add it to the map yet.
        var popup = new mapboxgl.Popup({
            closeButton: false
        });

        map.on('load', function () {
            // Add the source to query. In this example we're using
            // county polygons uploaded as vector tiles.
            map.addSource('counties', {
                'type': 'vector',
                'url': 'mapbox://mapbox.82pkq93d'
            });
            // Add transparent county polygons
            // for default display.
            map.addLayer(
                {
                    'id': 'counties',
                    'type': 'fill',
                    'source': 'counties',
                    'source-layer': 'original',
                    'paint': {
                        'fill-outline-color': 'rgba(0,0,0,0.1)',
                        'fill-color': 'rgba(0,0,0,0.1)'
                    }
                },
                'settlement-label'
            ); // Place polygons under labels.

            // Add filled county polygons
            // for highlighted display.
            map.addLayer(
                {
                    'id': 'counties-highlighted',
                    'type': 'fill',
                    'source': 'counties',
                    'source-layer': 'original',
                    'paint': {
                        'fill-outline-color': '#484896',
                        'fill-color': '#6e599f',
                        'fill-opacity': 0.75
                    },
                    // Display none by adding a
                    // filter with an empty string.
                    'filter': ['in', 'COUNTY', '']
                },
                'settlement-label'
            ); // Place polygons under labels.

            map.on('mousemove', 'counties', function (e) {
                // Change the cursor style as a UI indicator.
                map.getCanvas().style.cursor = 'pointer';

                // Use the first found feature.
                var feature = e.features[0];

                // Query the counties layer visible in the map.
                // Use filter to collect only results
                // with the same county name.
                var relatedFeatures = map.querySourceFeatures('counties', {
                    sourceLayer: 'original',
                    filter: ['in', 'COUNTY', feature.properties.COUNTY]
                });

                // Render found features in an overlay.
                overlay.innerHTML = '';

                // Total the populations of all features.
                var populationSum = relatedFeatures.reduce(function (
                    memo,
                    feature
                ) {
                    return memo + feature.properties.population;
                },
                    0);

                var title = document.createElement('strong');
                title.textContent =
                    feature.properties.COUNTY +
                    ' (' +
                    relatedFeatures.length +
                    ' found)';

                var population = document.createElement('div');
                population.textContent =
                    'Total population: ' + populationSum.toLocaleString();

                overlay.appendChild(title);
                overlay.appendChild(population);
                overlay.style.display = 'block';

                // Add features with the same county name
                // to the highlighted layer.
                map.setFilter('counties-highlighted', [
                    'in',
                    'COUNTY',
                    feature.properties.COUNTY
                ]);

                // Display a popup with the name of the county.
                popup
                    .setLngLat(e.lngLat)
                    .setText(feature.properties.COUNTY)
                    .addTo(map);
            });

            map.on('mouseleave', 'counties', function () {
                map.getCanvas().style.cursor = '';
                popup.remove();
                map.setFilter('counties-highlighted', ['in', 'COUNTY', '']);
                overlay.style.display = 'none';
            });
        });
    </script>
</body>
</html>