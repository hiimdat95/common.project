<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Add a default marker</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <!--<script src="https://vietmaps.vn/vietmap-gl-js/v1.0.0/vietmap-gl.js"></script>
    <link href="https://vietmaps.vn/vietmap-gl-js/v1.0.0/vietmap-gl.css" rel="stylesheet" />-->
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <style>
        .marker {
            display: block;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            padding: 0;
        }

        .mapboxgl-popup {
            max-width: 200px;
        }
    </style>
    <div id="map"></div>
    <!-- <img src="img/truong-hoc.png" /> -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>-->
    <!--<script>

        mapboxgl.accessToken = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5UZG1aak00WkRrM05qWTBZemM1TW1abU9EZ3dNVEUzTVdZd05ERTVNV1JsWkRnNE56YzRaQT09In0.eyJhdWQiOiJodHRwOlwvXC9vcmcud3NvMi5hcGltZ3RcL2dhdGV3YXkiLCJzdWIiOiJhZG1pbkBjYXJib24uc3VwZXIiLCJhcHBsaWNhdGlvbiI6eyJvd25lciI6ImFkbWluIiwidGllclF1b3RhVHlwZSI6InJlcXVlc3RDb3VudCIsInRpZXIiOiJVbmxpbWl0ZWQiLCJuYW1lIjoiTWFwIFNlcnZpY2UiLCJpZCI6MywidXVpZCI6bnVsbH0sInNjb3BlIjoiYW1fYXBwbGljYXRpb25fc2NvcGUgZGVmYXVsdCIsImlzcyI6Imh0dHBzOlwvXC9hbS52aWV0bWFwcy52bjo0NDNcL29hdXRoMlwvdG9rZW4iLCJ0aWVySW5mbyI6eyJVbmxpbWl0ZWQiOnsidGllclF1b3RhVHlwZSI6InJlcXVlc3RDb3VudCIsInN0b3BPblF1b3RhUmVhY2giOnRydWUsInNwaWtlQXJyZXN0TGltaXQiOjAsInNwaWtlQXJyZXN0VW5pdCI6bnVsbH19LCJrZXl0eXBlIjoiUFJPRFVDVElPTiIsInN1YnNjcmliZWRBUElzIjpbeyJzdWJzY3JpYmVyVGVuYW50RG9tYWluIjoiY2FyYm9uLnN1cGVyIiwibmFtZSI6InJvdXRlIiwiY29udGV4dCI6Ilwvcm91dGVcL3YxIiwicHVibGlzaGVyIjoiYWRtaW4iLCJ2ZXJzaW9uIjoidjEiLCJzdWJzY3JpcHRpb25UaWVyIjoiVW5saW1pdGVkIn0seyJzdWJzY3JpYmVyVGVuYW50RG9tYWluIjoiY2FyYm9uLnN1cGVyIiwibmFtZSI6InNlYXJjaCIsImNvbnRleHQiOiJcL3NlYXJjaFwvdjEuMC4wIiwicHVibGlzaGVyIjoiYWRtaW4iLCJ2ZXJzaW9uIjoidjEuMC4wIiwic3Vic2NyaXB0aW9uVGllciI6IlVubGltaXRlZCJ9LHsic3Vic2NyaWJlclRlbmFudERvbWFpbiI6ImNhcmJvbi5zdXBlciIsIm5hbWUiOiJNYXJrZXIiLCJjb250ZXh0IjoiXC9tYXJrZXJcLzEuMCIsInB1Ymxpc2hlciI6ImFkbWluIiwidmVyc2lvbiI6IjEuMCIsInN1YnNjcmlwdGlvblRpZXIiOiJVbmxpbWl0ZWQifV0sImNvbnN1bWVyS2V5IjoiYVJWbm1UUUhRbWxydXRwQ1RLNVdmdVdXV0E0YSIsImV4cCI6MzczNjMyNTYxMSwiaWF0IjoxNTg4ODQxOTY0LCJqdGkiOiIyMDI2NWY5NC1mOWZlLTQ0NGItYWQ2Ni1hM2Q3NDk0YzkwZTkifQ.ZE63gv6YTsxqXN3OorriRnG49zGMIWoXF5phsf__IDz6yPPf0u9qCDng6hK7dE27sl7C3N2TtCrranc8iOC2p7t7pV-7tdRh0sgmI8qrl_2_xCAdikXzs2e69_WnI8C11ObDGz_i6T6ypiYWUSb9eqi833MabegPY6BlZp0FRBBsB1ssDClDllzXiYf7RbppdAl4bDa-So1Jq6cWAUk9GTeTw53LsF6FriijShLPm-RmN0fgzBoKsDTuTbYIHy_x4GRpTamheAyiFLBEJvyzh5CR_ARUip7nfQLVafFsQ83T8mmuHoEhBpMMzFCJKmJ4paqD1bA4hc9ThsPOxr9iNg';
        var area;
        var geojson;
        $.ajax({
            url: "https://localhost:44362/api/Area/detail?areaId=2582904a-9a52-4963-9506-47aa655cc2eb",
            contentType: "application/json",
            dataType: 'json',
            success: function (result) {
                area = {
                    center: [result.centerLong, result.centerLat], maxBounds: [[result.minBoundLong, result.minBoundLat], [result.maxBoundLong, result.maxBoundLat]]
                }
                //var geojson = {
                //    'type': 'FeatureCollection',
                //    'features': [
                //        {
                //            'type': 'Feature',
                //            'properties': {
                //                'message': 'Foo',
                //                'iconSize': [50, 50]
                //            },
                //            'geometry': {
                //                'type': 'Point',
                //                'coordinates': [105.85079, 21.02893]
                //            }
                //        },
                //        {
                //            'type': 'Feature',
                //            'properties': {
                //                'message': 'Bar',
                //                'iconSize': [50, 50]
                //            },
                //            'geometry': {
                //                'type': 'Point',
                //                'coordinates': [105.85079, 21.0267]
                //            }
                //        }
                //    ]
                //};

                var map = new mapboxgl.Map({
                    container: 'map',
                    style: 'vietmap://styles/default/style.json',
                    hash: true,
                    center: area.center,
                    //center: [-65.017, -16.457],
                    zoom: 14,
                    //maxBounds: area.maxBounds,
                    attributionControl: false
                });

                var myArray = []
                $.ajax({
                    url: "https://localhost:44362/api/point/getall?areaId=2582904a-9a52-4963-9506-47aa655cc2eb",
                    contentType: "application/json",
                    dataType: 'json',
                    success: function (result) {
                        $.each(result, function (i, item) {

                            var point = {
                                type: "Feature"
                                , geometry: { type: 'Point', coordinates: [item.long, item.lat] }
                                , properties: { name: item.name, message: item.description, iconSize: [50, 50], image: item.icon }
                            };
                            myArray.push(point)

                        });
                        //var point = {
                        //    type: "Feature"
                        //    , geometry: {
                        //        type: 'Polygon',
                        //        coordinates: [
                        //            [
                        //                [105.85541, 21.02893],
                        //                [105.85545, 21.02893],
                        //                [105.85548, 21.02886],
                        //                [105.85586, 21.02776],
                        //                [105.85552, 21.02781],
                        //                [105.85521, 21.02782],
                        //                [105.85487, 21.02777],
                        //                [105.85479, 21.02764],
                        //                [105.85456, 21.0276],
                        //                [105.85438, 21.02754],
                        //                [105.85428, 21.02748],
                        //                [105.85364, 21.02745],
                        //                [105.85325, 21.02721],
                        //                [105.85316, 21.02708],
                        //                [105.8532, 21.02705],
                        //                [105.85336, 21.02692],
                        //                [105.85339, 21.02632],
                        //                [105.85357, 21.02623],
                        //                [105.85366, 21.0256],
                        //                [105.85371, 21.02532],
                        //                [105.85355, 21.02537],
                        //                [105.85231, 21.02575],
                        //                [105.85222, 21.02578],
                        //                [105.85211, 21.02581],
                        //                [105.85191, 21.02587],
                        //                [105.8511, 21.0261],
                        //                [105.85101, 21.02612],
                        //                [105.85064, 21.02623],
                        //                [105.85054, 21.02626],
                        //                [105.85057, 21.02634],
                        //                [105.85074, 21.02683],
                        //                [105.85079, 21.0267],
                        //                [105.85541, 21.02893],
                        //            ]
                        //        ]
                        //    }
                        //    , properties: {
                        //        message: 'item.description', iconSize: [50, 50]
                        //    }
                        //};
                        //myArray.push(point)
                        console.log('myArray', myArray);
                        geojson = {
                            'type': 'FeatureCollection',
                            'features': myArray
                        }
                        //
                        //map.addLayer({
                        //    'id': 'maine',
                        //    'type': 'fill',
                        //    'source': 'maine',
                        //    'layout': {},
                        //    'paint': {
                        //        'fill-color': '#088',
                        //        'fill-opacity': 0.8
                        //    }
                        //});
                        // add markers to map
                        geojson.features.forEach(function (marker) {
                            // create a DOM element for the marker
                            var el = document.createElement('div');
                            el.className = 'marker';
                            //el.style.backgroundImage='url(img/truong-hoc.png/)';
                            el.style.backgroundImage = "url('"+ marker.properties.image + "')";
                            //el.style.backgroundImage =
                            //    'url(https://placekitten.com/g/' +
                            //    marker.properties.iconSize.join('/') +
                            //    '/)';
                            el.style.width = marker.properties.iconSize[0] + 'px';
                            el.style.height = marker.properties.iconSize[1] + 'px';
                            // create the popup
                            //var popup = new mapboxgl.Popup({ offset: 25 }).setText(marker.properties.message);

                            // add marker to map
                            new mapboxgl.Marker(el)
                                .setLngLat(marker.geometry.coordinates)
                                .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
                                    .setHTML('<h3>' + marker.properties.name + '</h3><p>' + marker.properties.message + '</p>'))
                                .addTo(map);
                        });
                    }
                })

            }
        })
    </script>-->
</body>
</html>